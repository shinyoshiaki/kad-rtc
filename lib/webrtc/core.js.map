{"version":3,"file":"core.js","sourceRoot":"","sources":["../../src/webrtc/core.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  RTCPeerConnection,\n  RTCSessionDescription,\n  RTCIceCandidate\n} from \"wrtc\";\n\nimport Event from \"./utill/event\";\n\nexport interface message {\n  label: string;\n  data: any;\n  nodeId: string;\n}\n\ninterface option {\n  disable_stun: boolean;\n  stream: MediaStream;\n  track: MediaStreamTrack;\n  nodeId: string;\n  trickle: boolean;\n}\n\nexport default class WebRTC {\n  rtc: RTCPeerConnection;\n\n  onSignal = new Event<any>();\n  onConnect = new Event();\n  onDisconnect = new Event();\n  onData = new Event<message>();\n  onAddTrack = new Event<MediaStream>();\n\n  private dataChannels: { [key: string]: RTCDataChannel };\n\n  nodeId: string;\n  isConnected = false;\n  isDisconnected = false;\n  isOffer = false;\n\n  remoteStream: MediaStream | undefined;\n  timeoutPing: NodeJS.Timeout | undefined;\n\n  constructor(public opt: Partial<option> = {}) {\n    const { nodeId, stream, track } = opt;\n\n    this.dataChannels = {};\n    this.nodeId = nodeId || \"peer\";\n\n    this.rtc = this.prepareNewConnection();\n\n    if (stream) {\n      stream.getTracks().forEach(track => this.rtc.addTrack(track, stream));\n    } else if (track) {\n      this.rtc.addTrack(track);\n    }\n  }\n\n  private prepareNewConnection() {\n    const { disable_stun, trickle } = this.opt;\n\n    const peer: RTCPeerConnection = disable_stun\n      ? new RTCPeerConnection({\n          iceServers: []\n        })\n      : new RTCPeerConnection({\n          iceServers: [\n            {\n              urls: \"stun:stun.l.google.com:19302\"\n            }\n          ]\n        });\n\n    peer.ontrack = evt => {\n      const stream = evt.streams[0];\n      this.onAddTrack.excute(stream);\n      this.remoteStream = stream;\n    };\n\n    peer.oniceconnectionstatechange = () => {\n      switch (peer.iceConnectionState) {\n        case \"failed\":\n          break;\n        case \"disconnected\":\n          try {\n            this.timeoutPing = setTimeout(() => {\n              this.hangUp();\n            }, 2000);\n\n            this.send(\"ping\", \"live\");\n          } catch (error) {\n            console.warn({ error });\n          }\n          break;\n        case \"connected\":\n          if (this.timeoutPing) clearTimeout(this.timeoutPing);\n          break;\n        case \"closed\":\n          break;\n        case \"completed\":\n          break;\n      }\n    };\n\n    peer.onicecandidate = evt => {\n      if (!this.isConnected) {\n        if (evt.candidate) {\n          if (trickle) {\n            this.onSignal.excute({ type: \"candidate\", ice: evt.candidate });\n          }\n        } else {\n          if (!trickle && peer.localDescription) {\n            this.onSignal.excute(peer.localDescription);\n          }\n        }\n      }\n    };\n\n    peer.ondatachannel = evt => {\n      const dataChannel = evt.channel;\n      this.dataChannels[dataChannel.label] = dataChannel;\n      this.dataChannelEvents(dataChannel);\n    };\n\n    peer.onsignalingstatechange = e => {\n      this.negotiating = peer.signalingState != \"stable\";\n    };\n\n    return peer;\n  }\n\n  hangUp() {\n    this.isDisconnected = true;\n    this.isConnected = false;\n    this.onDisconnect.excute();\n  }\n\n  makeOffer() {\n    this.isOffer = true;\n    const { trickle } = this.opt;\n    this.createDatachannel(\"datachannel\");\n\n    this.rtc.onnegotiationneeded = async () => {\n      if (this.negotiating || this.rtc.signalingState != \"stable\") return;\n      this.negotiating = true;\n\n      const sdp = await this.rtc.createOffer().catch(console.warn);\n\n      if (!sdp) return;\n\n      const result = await this.rtc\n        .setLocalDescription(sdp)\n        .catch(err => JSON.stringify(err) + \"err\");\n      if (typeof result === \"string\") {\n        return;\n      }\n\n      const local = this.rtc.localDescription;\n\n      if (trickle && local) {\n        this.onSignal.excute(local);\n      }\n\n      this.negotiation();\n    };\n  }\n\n  negotiating = false;\n  private negotiation() {\n    this.rtc.onnegotiationneeded = async () => {\n      if (!this.isConnected) return;\n\n      try {\n        if (this.negotiating || this.rtc.signalingState != \"stable\") return;\n        this.negotiating = true;\n        const options = {};\n        const sessionDescription = await this.rtc.createOffer(options).catch();\n        await this.rtc.setLocalDescription(sessionDescription).catch();\n        const local = this.rtc.localDescription;\n        if (local) {\n          this.send(JSON.stringify(local), \"update\");\n        }\n      } finally {\n        this.negotiating = false;\n      }\n    };\n  }\n\n  private async setAnswer(sdp: any) {\n    if (this.isOffer) {\n      await this.rtc\n        .setRemoteDescription(new RTCSessionDescription(sdp))\n        .catch(console.warn);\n    }\n  }\n\n  private async makeAnswer(offer: any) {\n    const { trickle } = this.opt;\n\n    await this.rtc\n      .setRemoteDescription(new RTCSessionDescription(offer))\n      .catch(console.warn);\n\n    const answer = await this.rtc.createAnswer().catch(console.warn);\n    if (!answer) {\n      console.warn(\"no answer\");\n      return;\n    }\n\n    await this.rtc.setLocalDescription(answer).catch(console.warn);\n\n    const local = this.rtc.localDescription;\n\n    if (this.isConnected) {\n      this.send(JSON.stringify(local), \"update\");\n    } else if (trickle && local) {\n      this.onSignal.excute(local);\n    }\n\n    this.negotiation();\n  }\n\n  async setSdp(sdp: any) {\n    switch (sdp.type) {\n      case \"offer\":\n        this.makeAnswer(sdp);\n        break;\n      case \"answer\":\n        this.setAnswer(sdp);\n        break;\n      case \"candidate\":\n        await this.rtc\n          .addIceCandidate(new RTCIceCandidate(sdp.ice))\n          .catch(console.warn);\n        break;\n    }\n  }\n\n  private createDatachannel(label: string) {\n    if (!Object.keys(this.dataChannels).includes(label)) {\n      try {\n        const dc = this.rtc.createDataChannel(label);\n        this.dataChannelEvents(dc);\n        this.dataChannels[label] = dc;\n      } catch (dce) {}\n    }\n  }\n\n  private dataChannelEvents(channel: RTCDataChannel) {\n    channel.onopen = () => {\n      if (!this.isConnected) {\n        this.isConnected = true;\n        this.onConnect.excute();\n      }\n    };\n    try {\n      channel.onmessage = async event => {\n        if (!event) return;\n\n        if (channel.label === \"update\") {\n          const sdp = JSON.parse(event.data);\n          this.setSdp(sdp);\n        } else if (channel.label === \"live\") {\n          if (event.data === \"ping\") this.send(\"pong\", \"live\");\n          else if (this.timeoutPing) clearTimeout(this.timeoutPing);\n        } else {\n          this.onData.excute({\n            label: channel.label,\n            data: event.data,\n            nodeId: this.nodeId\n          });\n        }\n      };\n    } catch (error) {}\n    channel.onerror = err => {};\n    channel.onclose = () => {};\n  }\n\n  send(data: any, label?: string) {\n    label = label || \"datachannel\";\n    if (!Object.keys(this.dataChannels).includes(label)) {\n      this.createDatachannel(label);\n    }\n    try {\n      this.dataChannels[label].send(data);\n    } catch (error) {}\n  }\n\n  addTrack(track: MediaStreamTrack, stream: MediaStream) {\n    this.rtc.addTrack(track, stream);\n  }\n\n  disconnect() {\n    this.rtc.close();\n  }\n}\n"]}