{"version":3,"file":"mock.js","sourceRoot":"","sources":["../../../../src/kademlia/modules/peer/mock.ts"],"names":[],"mappings":";;;AACA,yEAAyC;AAE5B,QAAA,UAAU,GAAG,CAAC,GAAW,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;AAEzD,MAAqB,IAAI;IASvB,YAAmB,GAAW;QAAX,QAAG,GAAH,GAAG,CAAQ;QARtB,SAAI,GAAG,QAAQ,CAAC;QACxB,UAAK,GAAG,IAAI,eAAK,EAAO,CAAC;QACzB,iBAAY,GAAG,IAAI,eAAK,EAAE,CAAC;QAC3B,cAAS,GAAG,IAAI,eAAK,EAAE,CAAC;QAExB,WAAM,GAAG,IAAI,eAAK,EAAO,CAAC;QAc1B,QAAG,GAAG,CAAC,IAAqB,EAAE,EAAE;YAC9B,MAAM,QAAQ,GAAG,IAAI,eAAK,EAAO,CAAC;YAClC,IAAI,IAAI,CAAC,IAAI,EAAE;gBACb,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;gBAClD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE;oBAC1B,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;oBACtB,IAAI,GAAG,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG,EAAE;wBAC1B,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;qBACvB;gBACH,CAAC,CAAC,CAAC;aACJ;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC,CAAC;QAEF,gBAAW,GAAG,GAAS,EAAE;YACvB,OAAO,IAAI,CAAC,MAAM,CAAC;QACrB,CAAC,CAAA,CAAC;QAEF,aAAQ,GAAG,CAAO,GAAQ,EAAE,EAAE;YAC5B,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;YAChB,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC,SAAS,EAAE,CAAC;QACxD,CAAC,CAAA,CAAC;QAEF,cAAS,GAAG,CAAO,GAAQ,EAAE,EAAE;YAC7B,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;YACrB,MAAM,OAAO,GAAc,GAAG,CAAC,OAAO,CAAC;YACvC,UAAU,CAAC,GAAG,EAAE;gBACd,OAAO,CAAC,MAAM,EAAE,CAAC;YACnB,CAAC,EAAE,CAAC,CAAC,CAAC;YACN,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;YAExB,OAAO,IAAI,CAAC;QACd,CAAC,CAAA,CAAC;QAEF,eAAU,GAAG,GAAG,EAAE,GAAE,CAAC,CAAC;QA5CpB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE;YAC1B,IAAI;gBACF,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;gBACtB,IAAI,IAAI,CAAC,GAAG,EAAE;oBACZ,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;iBACzB;aACF;YAAC,OAAO,KAAK,EAAE,GAAE;QACpB,CAAC,CAAC,CAAC;IACL,CAAC;CAqCF;AAvDD,uBAuDC","sourcesContent":["import Base from \".\";\nimport Event from \"../../../utill/event\";\n\nexport const PeerModule = (kid: string) => new Peer(kid);\n\nexport default class Peer implements Base {\n  private type = \"webrtc\";\n  onRpc = new Event<any>();\n  onDisconnect = new Event();\n  onConnect = new Event();\n\n  onData = new Event<any>();\n  send: Event<any> | undefined;\n\n  constructor(public kid: string) {\n    this.onData.subscribe(raw => {\n      try {\n        const data = raw.data;\n        if (data.rpc) {\n          this.onRpc.excute(data);\n        }\n      } catch (error) {}\n    });\n  }\n\n  rpc = (send: { rpc: string }) => {\n    const observer = new Event<any>();\n    if (this.send) {\n      this.send.excute({ data: send, label: send.rpc });\n      this.onData.subscribe(raw => {\n        const data = raw.data;\n        if (raw.label === data.rpc) {\n          observer.excute(data);\n        }\n      });\n    }\n    return observer;\n  };\n\n  createOffer = async () => {\n    return this.onData;\n  };\n\n  setOffer = async (sdp: any) => {\n    this.send = sdp;\n    return { send: this.onData, connect: this.onConnect };\n  };\n\n  setAnswer = async (sdp: any) => {\n    this.send = sdp.send;\n    const connect: Event<{}> = sdp.connect;\n    setTimeout(() => {\n      connect.excute();\n    }, 0);\n    this.onConnect.excute();\n\n    return true;\n  };\n\n  disconnect = () => {};\n}\n"]}