{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/kademlia/services/signaling/index.ts"],"names":[],"mappings":";;;AAAA,8DAA4B;AAG5B,MAAqB,SAAS;IAK5B,YAAoB,UAAiC;QAAjC,eAAU,GAAV,UAAU,CAAuB;QAJ7C,eAAU,GAEd,EAAE,CAAC;IAEiD,CAAC;IAEjD,KAAK,CAAC,GAAW;QACvB,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IACpD,CAAC;IAED,MAAM,CAAC,GAAW;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;IAC9B,CAAC;IAED,MAAM,CAAC,GAAW;QAChB,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;YACnB,OAAO,EAAE,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC;SAC5C;aAAM;YACL,MAAM,KAAK,GAAG,IAAI,iBAAK,EAAQ,CAAC;YAChC,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAElC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;YAEvC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE;gBACvB,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACpB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACnB,CAAC,CAAC,CAAC;YAEH,OAAO,EAAE,IAAI,EAAE,CAAC;SACjB;IACH,CAAC;CACF;AAhCD,4BAgCC","sourcesContent":["import Event from \"rx.mini\";\nimport { Peer } from \"../../modules/peer/base\";\n\nexport default class Signaling {\n  private candidates: {\n    [kid: string]: { event: Event<Peer>; peer: Peer };\n  } = {};\n\n  constructor(private peerCreate: (kid: string) => Peer) {}\n\n  private exist(kid: string) {\n    return Object.keys(this.candidates).includes(kid);\n  }\n\n  delete(kid: string) {\n    delete this.candidates[kid];\n  }\n\n  create(kid: string) {\n    if (this.exist(kid)) {\n      return { candidate: this.candidates[kid] };\n    } else {\n      const event = new Event<Peer>();\n      const peer = this.peerCreate(kid);\n\n      this.candidates[kid] = { event, peer };\n\n      peer.onConnect.once(() => {\n        event.execute(peer);\n        this.delete(kid);\n      });\n\n      return { peer };\n    }\n  }\n}\n"]}