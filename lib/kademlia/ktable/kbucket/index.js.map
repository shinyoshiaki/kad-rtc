{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/kademlia/ktable/kbucket/index.ts"],"names":[],"mappings":";;AAIA;IAIE,iBAAY,GAAyB;QAAzB,oBAAA,EAAA,QAAyB;QAH7B,MAAC,GAAG,EAAE,CAAC;QACf,UAAK,GAAkC,EAAE,CAAC;QAGhC,IAAA,6BAAW,CAAS;QACpB,IAAA,UAAC,CAAU;QAEnB,IAAI,CAAC,CAAC,GAAG,WAAW,IAAI,CAAC,CAAC;IAC5B,CAAC;IAED,qBAAG,GAAH,UAAI,IAAU;QAAd,iBAaC;QAZC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;QAEzC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC;YAC1B,KAAI,CAAC,KAAK,GAAG,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,EAArB,CAAqB,CAAC,CAAC;QAChE,CAAC,CAAC,CAAC;QAEH,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC,EAAE;YAC9B,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;YAClC,gBAAgB;YAChB,8BAA8B;YAC9B,IAAI;SACL;IACH,CAAC;IAED,sBAAI,2BAAM;aAAV;YACE,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC;QACxC,CAAC;;;OAAA;IACH,cAAC;AAAD,CAAC,AA7BD,IA6BC","sourcesContent":["import Peer from \"../../modules/peer\";\n\nexport type Option = { kBucketSize: number };\n\nexport default class Kbucket {\n  private k = 20;\n  peers: { kid: string; peer: Peer }[] = [];\n\n  constructor(opt: Partial<Option> = {}) {\n    const { kBucketSize } = opt;\n    const { k } = this;\n\n    this.k = kBucketSize || k;\n  }\n\n  add(peer: Peer) {\n    this.peers.push({ kid: peer.kid, peer });\n\n    peer.onDisconnect.subscribe(() => {\n      this.peers = this.peers.filter(find => find.kid !== peer.kid);\n    });\n\n    if (this.peers.length > this.k) {\n      const discon = this.peers.shift();\n      // if (discon) {\n      //   discon.peer.disconnect();\n      // }\n    }\n  }\n\n  get length() {\n    return Object.keys(this.peers).length;\n  }\n}\n"]}