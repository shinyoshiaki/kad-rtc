{"version":3,"file":"testtools.js","sourceRoot":"","sources":["../../src/tests/testtools.ts"],"names":[],"mappings":";;;AAAA,uCAA0E;AAE1E,gFAAyD;AACzD,4EAAkD;AAClD,oFAAoD;AACpD,qDAAkD;AAClD,wDAAwB;AAExB,MAAa,KAAK;IAEhB,YAAoB,KAAa,EAAU,OAAY;QAAnC,UAAK,GAAL,KAAK,CAAQ;QAAU,YAAO,GAAP,OAAO,CAAK;QAD/C,UAAK,GAAG,CAAC,CAAC;QAGlB,UAAK,GAAG,GAAG,EAAE;YACX,IAAI,CAAC,KAAK,EAAE,CAAC;YACb,IAAI,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK;gBAAE,IAAI,CAAC,OAAO,EAAE,CAAC;QAChD,CAAC,CAAC;IALwD,CAAC;CAM5D;AARD,sBAQC;AAED,SAAsB,cAAc,CAAC,WAAmB,EAAE,GAAW;;QACnE,MAAM,KAAK,GAA0B,EAAE,CAAC;QAExC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;YAC5B,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;gBACtB,MAAM,IAAI,GAAG,wBAAmB,CAC9B,cAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,EAAE,EAC7B,EAAE,UAAU,EAAE,cAAU,EAAE,GAAG,EAAE,IAAI,cAAa,EAAE,EAAE,EACpD;oBACE,WAAW;iBACZ,CACF,CAAC;gBACF,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAClB;iBAAM;gBACL,MAAM,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC/B,MAAM,IAAI,GAAG,wBAAmB,CAC9B,cAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,EAAE,EAC7B,EAAE,UAAU,EAAE,cAAU,EAAE,GAAG,EAAE,IAAI,cAAa,EAAE,EAAE,EACpD;oBACE,WAAW;iBACZ,CACF,CAAC;gBACF,MAAM,KAAK,GAAG,cAAU,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBAC1C,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,WAAW,EAAE,CAAC;gBAC3C,MAAM,MAAM,GAAG,cAAU,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBAC1C,MAAM,SAAS,GAAG,MAAM,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gBAClD,MAAM,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;gBAEjC,qBAAS,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;gBACtB,qBAAS,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;gBAExB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAClB;SACF;QAED,KAAK,IAAI,IAAI,IAAI,KAAK,EAAE;YACtB,MAAM,kBAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;SACvC;QACD,OAAO,KAAK,CAAC;IACf,CAAC;CAAA;AAvCD,wCAuCC","sourcesContent":["import { DependencyInjection, dependencyInjection } from \"../kademlia/di\";\n\nimport KeyValueStore from \"../kademlia/modules/kvs/base\";\nimport PeerModule from \"../kademlia/modules/peer\";\nimport findNode from \"../kademlia/actions/findnode\";\nimport { listeners } from \"../kademlia/listeners\";\nimport sha1 from \"sha1\";\n\nexport class Count {\n  private count = 0;\n  constructor(private times: number, private resolve: any) {}\n\n  check = () => {\n    this.count++;\n    if (this.count === this.times) this.resolve();\n  };\n}\n\nexport async function testSetupNodes(kBucketSize: number, num: number) {\n  const nodes: DependencyInjection[] = [];\n\n  for (let i = 0; i < num; i++) {\n    if (nodes.length === 0) {\n      const node = dependencyInjection(\n        sha1(i.toString()).toString(),\n        { peerCreate: PeerModule, kvs: new KeyValueStore() },\n        {\n          kBucketSize\n        }\n      );\n      nodes.push(node);\n    } else {\n      const pre = nodes.slice(-1)[0];\n      const push = dependencyInjection(\n        sha1(i.toString()).toString(),\n        { peerCreate: PeerModule, kvs: new KeyValueStore() },\n        {\n          kBucketSize\n        }\n      );\n      const offer = PeerModule(push.kTable.kid);\n      const offerSdp = await offer.createOffer();\n      const answer = PeerModule(pre.kTable.kid);\n      const answerSdp = await answer.setOffer(offerSdp);\n      await offer.setAnswer(answerSdp);\n\n      listeners(offer, pre);\n      listeners(answer, push);\n\n      nodes.push(push);\n    }\n  }\n\n  for (let node of nodes) {\n    await findNode(node.kTable.kid, node);\n  }\n  return nodes;\n}\n"]}